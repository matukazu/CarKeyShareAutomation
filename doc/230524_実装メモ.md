

2023/05/24



# 現状
## 前提
次の評価条件を課し、すべての条件を最小にする個体をさがすことで最良のカギ分配をやろうとしている

■資源
- 乗車時間帯 次の4つ
    - 乗らない
    - 18時
    - 19時
    - 20時

- ユーザー 次の14人
    - Aさん 20時希望 運転可
    - Bさん 18時希望 運転可
    - Cさん 18時希望 運転可
    - Dさん 18時希望 運転可
    - Eさん 18時希望 運転可
    - Fさん 18時希望 運転不可
    - Gさん 20時希望 運転不可
    - Hさん 18時希望 運転不可
    - Iさん 18時希望 運転不可
    - Jさん 18時希望 運転不可
    - Kさん 18時希望 運転不可
    - Lさん 18時希望 運転不可
    - Mさん 18時希望 運転不可
    - Nさん 18時希望 運転不可

- 車 次の3つ
    - A 定員7名
    - B 定員5名
    - C 定員5名

- 車のカギ
  - 車1つに対して、「運転用」「予備」の2つで全6個（ex.車AのカギそれぞれA1、A2

■評価条件
- 運転できないユーザーが運転用カギを持っていない 
  - 「運転できないユーザーが運転用カギを持っている人数」× 重み大 を最小化
- 時間帯ごとに、使用するユーザーの合計人数が車の定員合計オーバーしてない
  - 「車の定員オーバーした人数合計（時間帯毎にオーバーした人数の合計）」 × 重み大 を最小化
- ユーザーが希望する乗車時間に可能な限り乗車する
  - 「希望乗車時間に乗れなかったユーザーの割合」 × 重み中 を最小化

## 概要
- 理想的にはすべての条件を満たす(すべての目的関数を0にできる個体が存在する)のに、現状のシステムではその個体にたどり着けない
    ※人間が振り分けたときにはすべての条件を満たす値が作れる

→ 実用に足るレベルに至ってない

## 詳細
以下、出力結果の例

> ===最適個体の目的関数===
> (0.0, 0.0, 0.5714285714285714)
> 
> ===車使用時間===
> ・車「車A」は「19時」
> ・車「車B」は「18時」
> ・車「車C」は「20時」
> ===かぎ分担===
> ・カギ「カギA1」は「A」さん
> ・カギ「カギA2」は「A」さん
> ・カギ「カギB1」は「B」さん
> ・カギ「カギB2」は「N」さん
> ・カギ「カギC1」は「B」さん
> ・カギ「カギC2」は「A」さん
> ===乗車時間===
> ・「A」さんは「19時」に帰る
> ・「B」さんは「18時」に帰る
> ・「C」さんは「18時」に帰る
> ・「D」さんは「20時」に帰る
> ・「E」さんは「20時」に帰る
> ・「F」さんは「19時」に帰る
> ・「G」さんは「20時」に帰る
> ・「H」さんは「18時」に帰る
> ・「I」さんは「19時」に帰る
> ・「J」さんは「20時」に帰る
> ・「K」さんは「18時」に帰る
> ・「L」さんは「19時」に帰る
> ・「M」さんは「20時」に帰る
> ・「N」さんは「18時」に帰る

理想状態のとき
- 目的関数がすべて0
- 車A,B→ 18時、車C→ 20時

現状、こうなっていない

## 試したこと

- 交差確率↑
- Population↑
- 世代↑
- 目的関数の重み付け変更

など、いくつかパラメータをいじってみたが改善しない(計算時間が延びるだけ)

## 解決のために。 仮説・きになることなど
- パラメータをいじってだめだった → アルゴリズム・目的関数の設定に問題がある可能性

■気になること
- 最小化すべき目的関数の中に、初期個体に課した制限と同様な制限を組み込むべきか？
背景：
  - 初期個体ではカギ-利用者表、車-時間帯表にあたる部分で値の重複をなくす処理が生きている
  - → 進化中の個体では値の重複が起きている例を見かけた気がする
  - → 交配の関係で初期個体に課した制限が破られるケースがあるか？
  - 最小化すべき目的関数の中に、初期個体に課した制限と同様な制限を組み込むべきか？

- 「車への乗車人数充填率」というものを定義し、これを最大化する目的関数を組み込むべきか？
    - 現状、人数オーバーしたらペナルティを与えるだけ。
    - 本当は1つの車に詰めて乗れば全員が希望時間に帰れるケースでも、オーバーしてなければペナルティ発生しないから、一旦目的関数の値が小さくなった個体データは現状維持で、より理想の分配に遷移できないのかも
    - 「車への乗車人数充填率」を定義し、これを最大化する動きも組み込めば脱却可能？
      - 例えば8人いて、5人乗り2台しか車が無いときに2人オーバーしたときより、5人乗り100台あって2人オーバーしたときの方が罪が重い気がする → この感覚を数値化したい
    - ただし懸念点として、「希望時間通りに帰るために、車の充填率を増やす」のであって、単に車の充填率を増やす目的関数を組み込んだ結果、希望乗車時間を無視する動きになりそうだから、ここの評価は単純な関数ではできないかもなと。

- 目的関数で返す値の標準化が出来ていない
  - いくつかの関数は条件に合わなかった人数を返している → 初期の資源が変われば幾らでも値が大きくなる
  - 一方で、いくつかの関数は条件に合わなかった割合を返している → 最大でも1。初期の資源の量が変わっても割合なので値が変わらない。
  - → 全部を割合で考えないと重み付けの係数の選び方が初期資源によって変わってくる → 初期資源が変わる度にまともな重み付けを手作業・直感で変えないといけなくなる。